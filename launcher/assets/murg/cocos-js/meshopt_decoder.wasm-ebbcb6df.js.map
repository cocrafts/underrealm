{"version":3,"file":"meshopt_decoder.wasm-ebbcb6df.js","sources":["../../../../../../../../../../external:emscripten/meshopt/meshopt_decoder.wasm.js"],"sourcesContent":["// This file is part of meshoptimizer library and is distributed under the terms of MIT License.\n// Copyright (C) 2016-2023, by Arseny Kapoulkine (arseny.kapoulkine@gmail.com)\nvar MeshoptDecoder = (function() {\n\t\"use strict\";\n\n\tvar instance;\n\tvar supported = false;\n\n\tvar ready = (instantiateWasm = {}) => {\n\n\t\tif (typeof instantiateWasm !== 'function') {\n\t\t\treturn Promise.reject(new Error('No wasm support detected'));\n\t\t}\n\n\t\treturn instantiateWasm().then(function(result) {\n\t\t\tsupported = true;\n\t\t\tinstance = result.instance;\n\t\t\tinstance.exports.__wasm_call_ctors();\n\t\t});\n\t}\n\n\tfunction decode(fun, target, count, size, source, filter) {\n\t\tvar sbrk = instance.exports.sbrk;\n\t\tvar count4 = (count + 3) & ~3;\n\t\tvar tp = sbrk(count4 * size);\n\t\tvar sp = sbrk(source.length);\n\t\tvar heap = new Uint8Array(instance.exports.memory.buffer);\n\t\theap.set(source, sp);\n\t\tvar res = fun(tp, count, size, sp, source.length);\n\t\tif (res == 0 && filter) {\n\t\t\tfilter(tp, count4, size);\n\t\t}\n\t\ttarget.set(heap.subarray(tp, tp + count * size));\n\t\tsbrk(tp - sbrk(0));\n\t\tif (res != 0) {\n\t\t\tthrow new Error(\"Malformed buffer data: \" + res);\n\t\t}\n\t}\n\n\tvar filters = {\n\t\tNONE: \"\",\n\t\tOCTAHEDRAL: \"meshopt_decodeFilterOct\",\n\t\tQUATERNION: \"meshopt_decodeFilterQuat\",\n\t\tEXPONENTIAL: \"meshopt_decodeFilterExp\",\n\t};\n\n\tvar decoders = {\n\t\tATTRIBUTES: \"meshopt_decodeVertexBuffer\",\n\t\tTRIANGLES: \"meshopt_decodeIndexBuffer\",\n\t\tINDICES: \"meshopt_decodeIndexSequence\",\n\t};\n\n\tvar workers = [];\n\tvar requestId = 0;\n\n\tfunction createWorker(url) {\n\t\tvar worker = {\n\t\t\tobject: new Worker(url),\n\t\t\tpending: 0,\n\t\t\trequests: {}\n\t\t};\n\n\t\tworker.object.onmessage = function(event) {\n\t\t\tvar data = event.data;\n\n\t\t\tworker.pending -= data.count;\n\t\t\tworker.requests[data.id][data.action](data.value);\n\n\t\t\tdelete worker.requests[data.id];\n\t\t};\n\n\t\treturn worker;\n\t}\n\n\tfunction initWorkers(count) {\n\t\tvar source =\n\t\t\t\"var instance; var ready = WebAssembly.instantiate(new Uint8Array([\" + new Uint8Array(unpack(wasm)) + \"]), {})\" +\n\t\t\t\".then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });\" +\n\t\t\t\"self.onmessage = workerProcess;\" +\n\t\t\tdecode.toString() + workerProcess.toString();\n\n\t\tvar blob = new Blob([source], {type: 'text/javascript'});\n\t\tvar url = URL.createObjectURL(blob);\n\n\t\tfor (var i = 0; i < count; ++i) {\n\t\t\tworkers[i] = createWorker(url);\n\t\t}\n\n\t\tURL.revokeObjectURL(url);\n\t}\n\n\tfunction decodeWorker(count, size, source, mode, filter) {\n\t\tvar worker = workers[0];\n\n\t\tfor (var i = 1; i < workers.length; ++i) {\n\t\t\tif (workers[i].pending < worker.pending) {\n\t\t\t\tworker = workers[i];\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tvar data = new Uint8Array(source);\n\t\t\tvar id = requestId++;\n\n\t\t\tworker.pending += count;\n\t\t\tworker.requests[id] = { resolve: resolve, reject: reject };\n\t\t\tworker.object.postMessage({ id: id, count: count, size: size, source: data, mode: mode, filter: filter }, [ data.buffer ]);\n\t\t});\n\t}\n\n\tfunction workerProcess(event) {\n\t\tready.then(function() {\n\t\t\tvar data = event.data;\n\t\t\ttry {\n\t\t\t\tvar target = new Uint8Array(data.count * data.size);\n\t\t\t\tdecode(instance.exports[data.mode], target, data.count, data.size, data.source, instance.exports[data.filter]);\n\t\t\t\tself.postMessage({ id: data.id, count: data.count, action: \"resolve\", value: target }, [ target.buffer ]);\n\t\t\t} catch (error) {\n\t\t\t\tself.postMessage({ id: data.id, count: data.count, action: \"reject\", value: error });\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tready: ready,\n\t\tsupported: supported,\n\t\tuseWorkers: function(count) {\n\t\t\tinitWorkers(count);\n\t\t},\n\t\tdecodeVertexBuffer: function(target, count, size, source, filter) {\n\t\t\tdecode(instance.exports.meshopt_decodeVertexBuffer, target, count, size, source, instance.exports[filters[filter]]);\n\t\t},\n\t\tdecodeIndexBuffer: function(target, count, size, source) {\n\t\t\tdecode(instance.exports.meshopt_decodeIndexBuffer, target, count, size, source);\n\t\t},\n\t\tdecodeIndexSequence: function(target, count, size, source) {\n\t\t\tdecode(instance.exports.meshopt_decodeIndexSequence, target, count, size, source);\n\t\t},\n\t\tdecodeGltfBuffer: function(target, count, size, source, mode, filter) {\n\t\t\tdecode(instance.exports[decoders[mode]], target, count, size, source, instance.exports[filters[filter]]);\n\t\t},\n\t\tdecodeGltfBufferAsync: function(count, size, source, mode, filter) {\n\t\t\tif (workers.length > 0) {\n\t\t\t\treturn decodeWorker(count, size, source, decoders[mode], filters[filter]);\n\t\t\t}\n\n\t\t\treturn ready.then(function() {\n\t\t\t\tvar target = new Uint8Array(count * size);\n\t\t\t\tdecode(instance.exports[decoders[mode]], target, count, size, source, instance.exports[filters[filter]]);\n\t\t\t\treturn target;\n\t\t\t});\n\t\t}\n\t};\n})();\n\nexport default MeshoptDecoder;"],"names":["instance","supported","ready","instantiateWasm","Promise","reject","Error","then","result","exports","__wasm_call_ctors","decode","fun","target","count","size","source","filter","sbrk","count4","tp","sp","length","heap","Uint8Array","memory","buffer","set","res","subarray","filters","NONE","OCTAHEDRAL","QUATERNION","EXPONENTIAL","decoders","ATTRIBUTES","TRIANGLES","INDICES","workers","requestId","createWorker","url","worker","object","Worker","pending","requests","onmessage","event","data","id","action","value","initWorkers","unpack","wasm","toString","workerProcess","blob","Blob","type","URL","createObjectURL","i","revokeObjectURL","mode","self","postMessage","error","useWorkers","decodeVertexBuffer","meshopt_decodeVertexBuffer","decodeIndexBuffer","meshopt_decodeIndexBuffer","decodeIndexSequence","meshopt_decodeIndexSequence","decodeGltfBuffer","decodeGltfBufferAsync","resolve","decodeWorker"],"mappings":"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"}